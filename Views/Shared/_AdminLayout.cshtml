<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title - Admin Panel</title>
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/Admin.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet" />
</head>
<body>
    <div class="admin-wrapper">
        <!-- Sidebar -->
        <nav class="admin-sidebar">
            <div class="sidebar-header">
                <h4>Admin Panel</h4>
            </div>
            <ul class="sidebar-menu">
                <li class="@(ViewBag.ActiveMenu == "Dashboard" ? "active" : "")">
                    <a href="@Url.Action("Dashboard", "Admin")">Dashboard</a>
                </li>
                <li class="@(ViewBag.ActiveMenu == "Requests" ? "active" : "")">
                    <a href="@Url.Action("Requests", "Admin")">Requests</a>
                </li>
                <li class="@(ViewBag.ActiveMenu == "Users" ? "active" : "")">
                    <a href="@Url.Action("Users", "Admin")">Users</a>
                </li>
                <li class="@(ViewBag.ActiveMenu == "Employees" ? "active" : "")">
                    <a href="@Url.Action("Employees", "Admin")">Employees</a>
                </li>
                <li class="@(ViewBag.ActiveMenu == "Companies" ? "active" : "")">
                    <a href="@Url.Action("Companies", "Admin")">Companies</a>
                </li>
                <li class="@(ViewBag.ActiveMenu == "Tools" ? "active" : "")">
                    <a href="@Url.Action("Tools", "Admin")">Tools</a>
                </li>
                <li class="divider"></li>
                <li>
                    <a href="@Url.Action("Index", "Attandance")">User Dashboard</a>
                </li>
                <li>
                    <a href="#" onclick="logout(); return false;">Logout</a>
                </li>
            </ul>
        </nav>

        <!-- Main Content -->
        <div class="admin-content">
            <header class="admin-header">
                <h2>@ViewBag.Title</h2>
                <div class="user-info" id="adminUserInfo"></div>
            </header>
            <main class="admin-main">
                @RenderBody()
            </main>
        </div>
    </div>

    <script src="~/Scripts/jquery-3.7.1.min.js"></script>
    <script src="~/Scripts/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        function logout() {
            Swal.fire({
                title: 'Logout',
                text: 'Are you sure you want to logout?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, logout'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.post('/Auth/Logout', function () {
                        window.location.href = '/Auth/Login';
                    });
                }
            });
        }

        $(function () {
            $.get('/Auth/CurrentUser', function (res) {
                if (res.Data) {
                    $('#adminUserInfo').html('<span>' + res.Data.Name + '</span>');
                }
            }).fail(function (xhr) {
                if (xhr.status === 401 || (xhr.responseJSON && xhr.responseJSON.Message)) {
                    window.location.href = '/Auth/Login';
                }
            });
        });

        // Global date formatter
        function formatDate(value) {
            if (!value) return 'N/A';
            var date = new Date(parseInt(value.replace('/Date(', '').replace(')/', '')));
            if (isNaN(date.getTime())) {
                date = new Date(value);
            }
            if (isNaN(date.getTime())) return 'N/A';
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        function formatDateTime(value) {
            if (!value) return 'N/A';
            var date = new Date(parseInt(value.replace('/Date(', '').replace(')/', '')));
            if (isNaN(date.getTime())) {
                date = new Date(value);
            }
            if (isNaN(date.getTime())) return 'N/A';
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Global error handler for AJAX
        $(document).ajaxError(function (event, xhr) {
            if (xhr.status === 401) {
                Swal.fire({
                    title: 'Session Expired',
                    text: 'Your session has expired. Please login again.',
                    icon: 'warning',
                    confirmButtonText: 'Login'
                }).then(() => {
                    window.location.href = '/Auth/Login';
                });
            }
        });
    </script>
    @RenderSection("Scripts", required: false)
</body>
</html>
